<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Locked Room - New Zealand</title>

    <!-- Bootstrap -->
    <link href="/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- <script src="https://maps.googleapis.com/maps/api/js"></script>-->
  </head>
  <body>

    <!-- NAVIGATION -->

    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
            <img src="/logo.png" alt="The Locked Room">
          </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/"><strong>Home</strong></a></li>
            <li><a href="/#finding-us">Contact us</a></li>
            <li><a href="/#faqs">FAQs</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>


    <!-- <hr class="featurette-divider"> -->

    <div class="container">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <h2><a name="book">BOOK A ROOM:</a><h2>
          <iframe src="//thelockedroom.gettimely.com/book/embed?" scrolling="no" id="timelyWidget" style="width: 100%; min-height: 800px; height: auto; border: 1px solid #E7E7E7; margin: auto auto"></iframe>
        </div>
      </div>
    </div>

<!--     <div id="calendar" class="container text-center">
    Please wait while the booking system loads <img src="/loading.gif">
    </div>

    <div style="display: none" id="booking_form">
      <form action="" method="PUT" class="col-md-6 col-md-offset-3 " onsubmit="submit_booking();">
        <div class="input-group input-group-lg">
          <span class="input-group-addon glyphicon glyphicon-user" id="basic-addon1"></span>
          <input type="text" class="form-control" placeholder="Name" aria-describedby="basic-addon1">
        </div>
        <div class="input-group input-group-lg">
          <span class="input-group-addon glyphicon glyphicon-envelope" id="basic-addon1"></span>
          <input type="text" class="form-control" placeholder="Email Address" aria-describedby="basic-addon2">
        </div>
        <input type="hidden" name="time" value="None">
        <button type="submit" class="btn btn-lg btn-success"><strong>Request booking</strong></button>
      </form>
    </div> -->

    <!-- FOOTER -->

    <footer class="footer">
        <div class="container-fluid">
          <img src="/logo.png" alt="The Locked Room">
          <div class="text-muted pull-right">
            Copyright 2015 The Locked Room
          </div>
        </div>
    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript">

      var nameOfDay = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      var nameOfMonth = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
      function load_calendar() {
        $.ajax('/schedule.php', {
          'dataType': 'json',
          'error': function() {
            $("#calendar").html("Sorry, the booking system is under maintenance. Please try again later.");
          },
          'success': render_calendar
        }
        );
      }

      function as_customDateString(d) {
        var str = d.toDateString();
        return str.substr(0,str.length-5);
      }

      function as_timeString(d) {
        var minutes = d.getMinutes();
        if (minutes < 10) {
          minutes = '0' + minutes
        }

        if (d.getHours < 13) {
          return d.getHours() + ':' + minutes + ' AM';
        }
        else {
          return d.getHours() - 12 + ':' + minutes + ' PM';
        }
      }

      function render_calendar(response, status) {
        var area = $("#calendar");
        area.html('');
        var buffer = '<h2><span class="text-muted">Step 1:</span> Select a time to play</h2>:';
        var last_date = null;
        var times = {};

        for (datestring in response) {
          date = new Date(datestring);
          if (as_customDateString(date) in times) {
            times[as_customDateString(date)][as_timeString(date)] = response[datestring];
          }
          else {
            times[as_customDateString(date)] = {}
            times[as_customDateString(date)][as_timeString(date)] = response[datestring];
          }
        }
        console.log(times);
        for (date in times) {
          buffer += '<div class="col-md-3">' +
                        '<div class="panel panel-default">' +
                          '<div class="panel-heading">' +
                            date +
                          '</div>' +
                          '<div class="panel-body">';
          for (time in times[date]) {
            if (times[date][time] == 0) {
              buffer += '<button class="btn btn-primary btn-lg" onclick="set_booking_time(\''+date+'\',\''+time+'\')">' + time + '</button>';
            }
            else {
              buffer += '<a tabindex="0" role="button" class="btn btn-unavailable btn-lg" data-trigger="focus" title="Session unavailable" data-toggle="popover" data-content="Sorry this session has already been booked">' + time + '</a>';
            }

          }
          buffer += '</div>' +
                  '</div>' +
                '</div>';
        }
        buffer += '<h2><span class="text-muted">Step 2:</span> Enter your details</h2>:';
        area.html(buffer);
        area.append($("#booking_form").html());
        $(function () {
          $('[data-toggle="popover"]').popover()
        })
      }

      function set_booking_time(date, time) {
        alert(date+time);
      }

      function submit_booking() {
        alert('yus');
      }

      load_calendar();
    </script>
  </body>
</html>